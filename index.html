
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>小组知识库</title>
  <meta name="author" content="邱俊炜">

  
  <meta name="description" content="PlatForm win32 64bit
python version python2.7 32bit 入门 如果是Linux系统的FirstRun，可以按照官方这个步骤去做。官方说Windows也差不多，但在我的环境下有问题，（我安装了Cygwin，在Cygwin环境下运行的）。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rtwf.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="小组知识库" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">小组知识库</a></h1>
  
    <h2>学而时习之，不亦乐乎</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rtwf.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">目录</a></li>
  <li><a href="/about">关于我</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      


  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/23/buildbot-build/">Buildbot的搭建总结</a></h1>
    
    
    <p class="meta">
      








  


<time datetime="2014-07-23T18:56:27+08:00" pubdate data-updated="true">Jul 23<sup>rd</sup>, 2014</time>
	  

<span class="tags">
  Tag:
  
    <a href='/blog/tags/build/'>build</a>
  
</span>

      <span class="share-to-weibo">
        <a href="javascript:void(0)" onclick="window.open('http://service.weibo.com/share/share.php?appkey=&amp;ralateUid=&amp;title=Buildbot的搭建总结 - &amp;url=http://rtwf.github.io/blog/2014/07/23/buildbot-build/', null, 'width=615,height=505,toolbar=0,status=0')" class="sina-weibo" title="分享到新浪微博"></a>

        <a href="javascript:void(0)" onclick="window.open('http://share.v.t.qq.com/index.php?c=share&amp;a=index&amp;appkey=&amp;title=Buildbot的搭建总结 - &amp;url=http://rtwf.github.io/blog/2014/07/23/buildbot-build/', null, 'width=700,height=680,toolbar=0,status=0')" class="tencent-weibo" title="分享到腾讯微博"></a>

        <a href="javascript:void(0)" onclick="window.open('https://twitter.com/intent/tweet?text=Buildbot的搭建总结 - http://rtwf.github.io/blog/2014/07/23/buildbot-build/', null, 'width=600,height=300,toolbar=0,status=0')" class="twitter" title="分享到Twitter"></a>
      </span>
    </p>
  
  </header>


  <div class="entry-content"><p><strong>PlatForm</strong>                    <em>win32 64bit</em>
<strong>python version</strong>              <em>python2.7 32bit</em></p>

<h2>入门</h2>

<p>如果是Linux系统的<a href="http://docs.buildbot.net/current/tutorial/firstrun.html">FirstRun</a>，可以按照官方这个步骤去做。官方说Windows也差不多，但在我的环境下有问题，（我安装了Cygwin，在Cygwin环境下运行的）。 virtualenv  这个的easy_install太旧了。我用sandbox运行 easy_install buildbot总是提示缺少库。更新easy_install 也没用。 关于用easy_install -U setuptool的产生的Perssion Denied问题可以看<a href="http://stackoverflow.com/questions/17601020/easy-install-exe-permission-denied-on-windows-8">这里</a></p>

<p>Windows 下的安装步骤。参考<a href="http://trac.buildbot.net/wiki/RunningBuildbotOnWindows">这里</a> 下面说一下我遇到的问题。
我的建议是都安装x86的版本。python  PyWin32版本。 有一些需要编译的python库很麻烦如pysqlite 。python2.7的大部分库是用VS2008编译的，可以去下个VS2008的Express。如果是Windows 64bit出现问题参考<a href="http://stackoverflow.com/questions/4676728/value-error-trying-to-install-python-for-windows-extensions">这里</a>
因为我装了好几个版本的VS。我的问题弄了好久没解决。还好网上有编译好的版本。
<a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#pywin32">http://www.lfd.uci.edu/~gohlke/pythonlibs/#pywin32</a> 我在这里下了个pysqlite的exe.
如果下载的是.zip文件，则解压，然后dos进入该目录，执行<code>python setup.py install</code>命令即可
也在网上找了个OpenSSL windwos版的下载安装好了。
大部分需要的组件我都上传的网盘了地址<a href="http://pan.baidu.com/s/1dD7tlUp">http://pan.baidu.com/s/1dD7tlUp</a>
检查是否buildbot和buildbot-slave是否安装好了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>buildbot --version
</span><span class='line'>buildslave --version</span></code></pre></td></tr></table></div></figure>


<p>如果一切正常那可以按照<a href="http://docs.buildbot.net/current/tutorial/firstrun.html">FirstRun</a> 这里后面的继续去做了。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/07/23/buildbot-build/">阅读全文 &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      


  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/17/vs-error-collection/">Vs编译错误及解决办法</a></h1>
    
    
    <p class="meta">
      








  


<time datetime="2014-07-17T18:18:48+08:00" pubdate data-updated="true">Jul 17<sup>th</sup>, 2014</time>
	  

<span class="tags">
  Tag:
  
    <a href='/blog/tags/compile/'>Compile</a>
  
</span>

      <span class="share-to-weibo">
        <a href="javascript:void(0)" onclick="window.open('http://service.weibo.com/share/share.php?appkey=&amp;ralateUid=&amp;title=Vs编译错误及解决办法 - &amp;url=http://rtwf.github.io/blog/2014/07/17/vs-error-collection/', null, 'width=615,height=505,toolbar=0,status=0')" class="sina-weibo" title="分享到新浪微博"></a>

        <a href="javascript:void(0)" onclick="window.open('http://share.v.t.qq.com/index.php?c=share&amp;a=index&amp;appkey=&amp;title=Vs编译错误及解决办法 - &amp;url=http://rtwf.github.io/blog/2014/07/17/vs-error-collection/', null, 'width=700,height=680,toolbar=0,status=0')" class="tencent-weibo" title="分享到腾讯微博"></a>

        <a href="javascript:void(0)" onclick="window.open('https://twitter.com/intent/tweet?text=Vs编译错误及解决办法 - http://rtwf.github.io/blog/2014/07/17/vs-error-collection/', null, 'width=600,height=300,toolbar=0,status=0')" class="twitter" title="分享到Twitter"></a>
      </span>
    </p>
  
  </header>


  <div class="entry-content"><h3>error C2220: 警告被视为错误 &ndash; 没有生成“object”文件</h3>

<p>这种错误的原因是：原因是该文件的代码页为英文，而我们系统中的代码页为中文。
解决方案：
1. 在VS2010以后在文件->高级保存选项，设置UTF-8的格式，重新保存一次。 或者用其它的程序保存成UTF-8的格式。</p>

<ol>
<li>如果上述不能去掉错误，还可以点击项目，右击选择属性->配置属性->c/c++&ndash;>常规，将“警告视为错误”的选项改为“否”。就可以！</li>
</ol>


<h3>error C2143: 语法错误 : 缺少“;”(在“类型”的前面)</h3>

<p>C99之前都要求，函数内的局部变量要在开始处定义。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="nf">f</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;j is %d&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这可能出现在c文件编译的时候，VS2012都不完全支持C99。须要调整一下代码。把函数内的局部变量放到函数开头去定义。或者改成cpp后缀的文件</p>

<p>VS2010之后开始支持C99，所以在VS2008之前如果出现 找不到 stdint.h 文件的话。可以升级到VS2010之后。</p>

<h3>LNK2001: 无法解析的外部符号 __iob 问题的解决方法</h3>

<ol>
<li><p>缺少libc.lib
解决这个问题的方法是去掉链接到libc.lib，具体地点：项目-〉属性-〉配置属性-〉链接器-〉忽略特定库。</p></li>
<li><p>unresolved external symbol <code>__iob</code>
这个<code>__iob</code>找不到的问题费了我大部分的时间。跟踪到stdio.h文件，发现那里有个关于iob的宏，终于搞定。加入一句话到.cpp文件中：<code>extern "C" { FILE _iob[3] = {__iob_func()[0], __iob_func()[1], __iob_func()[2]}; }</code></p></li>
<li><p>NULL iterator
STL已经不能有NULL迭代器这么一说了，想想也对，在NULL迭代器上进行++或&mdash;之类的是不成立的。</p></li>
<li><p>结构体默认函数
在VC6中，结构体的默认运算符==或者&lt;之类的如果不实现也可以作为STL元素放入list等容器中。但VC8不行了，因为它已经不再为结构体生成缺省的操作符函数。</p></li>
</ol>


<p>该错误主要是由于静态库在VC6编译而主程序在VC2005编译，大家用的CRT不同。解决办法，代码中增加</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#ifdef __cplusplus</span>
</span><span class='line'><span class="k">extern</span> <span class="s">&quot;C&quot;</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="kt">FILE</span> <span class="n">_iob</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">__iob_func</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">__iob_func</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">__iob_func</span><span class="p">()[</span><span class="mi">2</span><span class="p">]};</span>
</span></code></pre></td></tr></table></div></figure>


<p>此错误的产生根源：
在VC6的stdio.h之中有如下定义</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">_CRTIMP</span> <span class="k">extern</span> <span class="kt">FILE</span> <span class="n">_iob</span><span class="p">[];</span>
</span><span class='line'><span class="cp">#define stdin (&amp;_iob[0])</span>
</span><span class='line'><span class="cp">#define stdout (&amp;_iob[1])</span>
</span><span class='line'><span class="cp">#define stderr (&amp;_iob[2])</span>
</span></code></pre></td></tr></table></div></figure>


<p>stdin、stdout、stderr是通过查<em>iob数组得到的。所以，VC6编译的程序、静态库只要用到了printf、scanf之类的函数，都要链接</em>iob数组。</p>

<p>而在vc2005中，stdio.h中变成了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">_CRTIMP</span> <span class="kt">FILE</span> <span class="o">*</span> <span class="kr">__cdecl</span> <span class="nf">__iob_func</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'><span class="cp">#define stdin (&amp;__iob_func()[0])</span>
</span><span class='line'><span class="cp">#define stdout (&amp;__iob_func()[1])</span>
</span><span class='line'><span class="cp">#define stderr (&amp;__iob_func()[2])</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>_iob</code>数组不再是显式的暴露出来了，需要调用<em><em>iob_func()函数获得。所以vc6的静态库链接VC2005的C运行库就会找不到</em>iob数组.
通过重新定义
<code>FILE _iob[3] = {__iob_func()[0], __iob_func()[1], __iob_func()[2]};</code>
就把vc6需要用到的</em>iob数组搞出来了</p>
</div>
  
  


    </article>
  
  
    <article>
      


  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/09/eclipse-tools/">Eclipse 工具</a></h1>
    
    
    <p class="meta">
      








  


<time datetime="2014-07-09T19:33:01+08:00" pubdate data-updated="true">Jul 9<sup>th</sup>, 2014</time>
	  

<span class="tags">
  Tag:
  
    <a href='/blog/tags/tools/'>tools</a>
  
</span>

      <span class="share-to-weibo">
        <a href="javascript:void(0)" onclick="window.open('http://service.weibo.com/share/share.php?appkey=&amp;ralateUid=&amp;title=Eclipse 工具 - &amp;url=http://rtwf.github.io/blog/2014/07/09/eclipse-tools/', null, 'width=615,height=505,toolbar=0,status=0')" class="sina-weibo" title="分享到新浪微博"></a>

        <a href="javascript:void(0)" onclick="window.open('http://share.v.t.qq.com/index.php?c=share&amp;a=index&amp;appkey=&amp;title=Eclipse 工具 - &amp;url=http://rtwf.github.io/blog/2014/07/09/eclipse-tools/', null, 'width=700,height=680,toolbar=0,status=0')" class="tencent-weibo" title="分享到腾讯微博"></a>

        <a href="javascript:void(0)" onclick="window.open('https://twitter.com/intent/tweet?text=Eclipse 工具 - http://rtwf.github.io/blog/2014/07/09/eclipse-tools/', null, 'width=600,height=300,toolbar=0,status=0')" class="twitter" title="分享到Twitter"></a>
      </span>
    </p>
  
  </header>


  <div class="entry-content"><h2>配置Javap工具</h2>

<p>在Eclipse的Menu中打开Run->External Tools->External Tools Configurations
添加一个新的项。
<img src="https://farm3.staticflickr.com/2928/14617040064_088658d740_o.png">
<img src="https://farm3.staticflickr.com/2912/14639067183_6776a117b8_b.jpg">
javap这个工具可以用来输出java类 对应jni的描述。
<img src="http://farm3.staticflickr.com/2939/14619183735_dfb1841c44_b.jpg">
把Signature 后面的字符串拷贝就行了（<strong>后面的分号也要拷贝</strong>）。这样可以在GetField中使用了。
env->GetField(cls, &ldquo;fieldName&rdquo;, &ldquo;Signature&rdquo;);
javah的工具配置类似。</p>

<h2>定位文件目录</h2>

<p>跟VS一样，VS在标签中右键打开文件目录一样。Eclipse须要配置。也是在External Tool中。
新建一个
<img src="http://farm3.staticflickr.com/2931/14618685852_2340a8acab_b.jpg">
Build选项下面就不要勾上build before launch了。</p>

<p><a href="http://www.open-open.com/bbs/view/1320934157953/">Eclipse快捷键 10个最有用的快捷键</a></p>
</div>
  
  


    </article>
  
  
    <article>
      


  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/09/local-reference-table-overflow/">Andriod Ndk Error Local Reference Table Overflow Max 512</a></h1>
    
    
    <p class="meta">
      








  


<time datetime="2014-07-09T12:57:43+08:00" pubdate data-updated="true">Jul 9<sup>th</sup>, 2014</time>
	  

<span class="tags">
  Tag:
  
    <a href='/blog/tags/jni/'>JNI</a>
  
</span>

      <span class="share-to-weibo">
        <a href="javascript:void(0)" onclick="window.open('http://service.weibo.com/share/share.php?appkey=&amp;ralateUid=&amp;title=Andriod Ndk Error Local Reference Table Overflow Max 512 - &amp;url=http://rtwf.github.io/blog/2014/07/09/local-reference-table-overflow/', null, 'width=615,height=505,toolbar=0,status=0')" class="sina-weibo" title="分享到新浪微博"></a>

        <a href="javascript:void(0)" onclick="window.open('http://share.v.t.qq.com/index.php?c=share&amp;a=index&amp;appkey=&amp;title=Andriod Ndk Error Local Reference Table Overflow Max 512 - &amp;url=http://rtwf.github.io/blog/2014/07/09/local-reference-table-overflow/', null, 'width=700,height=680,toolbar=0,status=0')" class="tencent-weibo" title="分享到腾讯微博"></a>

        <a href="javascript:void(0)" onclick="window.open('https://twitter.com/intent/tweet?text=Andriod Ndk Error Local Reference Table Overflow Max 512 - http://rtwf.github.io/blog/2014/07/09/local-reference-table-overflow/', null, 'width=600,height=300,toolbar=0,status=0')" class="twitter" title="分享到Twitter"></a>
      </span>
    </p>
  
  </header>


  <div class="entry-content"><h1>引言</h1>

<p>在Android开发中，常会遇到 local reference table overflow的错误。原因是从java代码进入jni层的本地代码调用时，Dalvik就会创建一张local reference表来存储local reference， 这张表的表项数有最大限制。一般为512个。当表项数超过最大值限制时，Dalvik就会抛出异常。</p>

<figure class='code'><figcaption><span>下面这段代码就会导致溢出</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">jclass</span> <span class="n">strinClass</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">800</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">stringClass</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="s">&quot;java/lang/String&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">.....</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>什么是Local References？</h1>

<p>大多数的JNI函数都创建了Local reference（以下简称为<em>LR</em>）。 比如 NewObject, NewString&hellip;. 和 FindClass 等。</p>

<p>一个<em>LR</em>只有在创建它的的一个局部作用域内有效。在超出这个作用域之后，就可能会被释放。 所有的<em>LR</em>在本地函数调用时创建的，在这个本地函数返回时就会被释放。</p>

<p>你不能把一个Local reference 保存在静态变量中，然后在后面继续调用，这是不安全的。</p>

<figure class='code'><figcaption><span>错误的例子</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/* This code is illegal */</span>
</span><span class='line'><span class="n">jstring</span>
</span><span class='line'><span class="nf">MyNewString</span><span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jchar</span> <span class="o">*</span><span class="n">chars</span><span class="p">,</span> <span class="n">jint</span> <span class="n">len</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">static</span> <span class="n">jclass</span> <span class="n">stringClass</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>    <span class="n">jmethodID</span> <span class="n">cid</span><span class="p">;</span>
</span><span class='line'>    <span class="n">jcharArray</span> <span class="n">elemArr</span><span class="p">;</span>
</span><span class='line'>    <span class="n">jstring</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">stringClass</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">stringClass</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="n">env</span><span class="p">,</span>
</span><span class='line'>                                        <span class="s">&quot;java/lang/String&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">stringClass</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span> <span class="cm">/* exception thrown */</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/* It is wrong to use the cached stringClass here,</span>
</span><span class='line'><span class="cm">       because it may be invalid. */</span>
</span><span class='line'>    <span class="n">cid</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetMethodID</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">stringClass</span><span class="p">,</span>
</span><span class='line'>                              <span class="s">&quot;&lt;init&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;([C)V&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="n">elemArr</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewCharArray</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>  <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewObject</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">stringClass</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">elemArr</span><span class="p">);</span>
</span><span class='line'>    <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">DeleteLocalRef</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">elemArr</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">JNIEXPORT</span> <span class="n">jstring</span> <span class="n">JNICALL</span>
</span><span class='line'><span class="nf">Java_C_f</span><span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">this</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">c_str</span> <span class="o">=</span> <span class="p">...;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">MyNewString</span><span class="p">(</span><span class="n">c_str</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Java 中</span>
</span><span class='line'><span class="p">...</span> <span class="o">=</span> <span class="n">C</span><span class="p">.</span><span class="n">f</span><span class="p">();</span>
</span><span class='line'><span class="p">...</span> <span class="o">=</span> <span class="n">C</span><span class="p">.</span><span class="n">f</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>假设我调用了两次Java_C_f。 其中调用了MyNewString， MyNewString的想法是把stringClass这个<em>LR</em> 初始化一次后保存起来，下次可以继续用。但根据JNI的规则。在MyNewString返回时，所有的<em>LR</em>都会被释放。所以第二次调用时stringClass就是Invalid的。</p>

<p>虽然VM会在本地函数返回时，释放所有的<em>LR</em>，但我们也可以显示的控制<em>LR</em>的释放。<em>LR</em>引用的对象只有在，<em>LR</em>无效的时候才会被GC回收，在MyNewString函数中调用的DeleteLocalRef 释放中间的变量elemArr，这样GC可以立即回收这个<em>LR</em> 不然elemArr这个<em>LR</em>会等到本地函数MyNewString返回时才被回收。</p>

<p><em>LR</em>只能在创建它的线程中使用，在其它的线程中使用它是错误的。所以用一个全局变量保存在其它线程中用是不可行的。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/07/09/local-reference-table-overflow/">阅读全文 &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      


  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/03/how-to-install-octproess/">如何使用本博客</a></h1>
    
    
    <p class="meta">
      








  


<time datetime="2014-07-03T17:06:14+08:00" pubdate data-updated="true">Jul 3<sup>rd</sup>, 2014</time>
	  

<span class="tags">
  Tag:
  
    <a href='/blog/tags/octopress/'>octopress</a>
  
</span>

      <span class="share-to-weibo">
        <a href="javascript:void(0)" onclick="window.open('http://service.weibo.com/share/share.php?appkey=&amp;ralateUid=&amp;title=如何使用本博客 - &amp;url=http://rtwf.github.io/blog/2014/07/03/how-to-install-octproess/', null, 'width=615,height=505,toolbar=0,status=0')" class="sina-weibo" title="分享到新浪微博"></a>

        <a href="javascript:void(0)" onclick="window.open('http://share.v.t.qq.com/index.php?c=share&amp;a=index&amp;appkey=&amp;title=如何使用本博客 - &amp;url=http://rtwf.github.io/blog/2014/07/03/how-to-install-octproess/', null, 'width=700,height=680,toolbar=0,status=0')" class="tencent-weibo" title="分享到腾讯微博"></a>

        <a href="javascript:void(0)" onclick="window.open('https://twitter.com/intent/tweet?text=如何使用本博客 - http://rtwf.github.io/blog/2014/07/03/how-to-install-octproess/', null, 'width=600,height=300,toolbar=0,status=0')" class="twitter" title="分享到Twitter"></a>
      </span>
    </p>
  
  </header>


  <div class="entry-content"><p><strong>注意 你的系统的环境变量一定不要有中文, 如果在rake中提示 invalid byte sequence in UTF-8 (ArgumentError) 请检查你的所有的系统环境变量</strong></p>

<ol>
<li>下载和安装git， 把git安装目录的bin和cmd文件目录加到path中。</li>
<li>下载和安装ruby1.9.3，安装时可以勾选 加到path中。 安装完成后可以通过ruby &mdash;version来测试是否安装成功</li>
<li>去网上下载一个<a href="https://github.com/downloads/oneclick/rubyinstaller/DevKit-tdm-32-4.5.2-20111229-1559-sfx.exe">DevKit-tdm-32-4.5.2-20111229-1559-sfx.exe</a> 解压到一个目录如E:\Devkit。dos cd 到这个目录。执行如下命令:</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ruby dk.rb init 
</span><span class='line'>ruby dk.rb install</span></code></pre></td></tr></table></div></figure>


<p><strong>
安装之后，要把这个 E:/Devkit/mingw/bin这个目录加到你的系统环境path，如果已经安装了MinGw并且在path中配置好的，要把这个mingw拷贝过去覆盖掉。
</strong></p>

<p>博客的代码高亮需要python环境的支持。去下个python2.7安装。python 安装完成后。执行下面的命令</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>easy_install pygments</span></code></pre></td></tr></table></div></figure>


<h2>设置本地环境</h2>

<p>为了支持中文UTF-8编码，在Windows的环境变量中增加下面的选项。(<em>否则rake 时会有编码错误</em>)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>LANG = zh_CN.UTF-8
</span><span class='line'>LC_ALL = zh_CN.UTF-8</span></code></pre></td></tr></table></div></figure>


<ul>
<li>配置git</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git config --global user.name "yourname"
</span><span class='line'>git config --global user.email "youremail"</span></code></pre></td></tr></table></div></figure>


<p>更新gem的更新源，ruby的官方网站经常被和谐。换成国内的更新源，这样速度就快多了，变更如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem sources -a http://ruby.taobao.org/
</span><span class='line'>gem sources -r http://rubygems.org/</span></code></pre></td></tr></table></div></figure>


<h2>下载并配置Blog</h2>

<p>在某个目录下，DOS命令</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="nb">clone</span> <span class="n">git</span><span class="vi">@github</span><span class="o">.</span><span class="n">com</span><span class="ss">:rtwf</span><span class="o">/</span><span class="n">rtwf</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">git</span> <span class="n">rtwf</span>
</span><span class='line'>
</span><span class='line'><span class="err">如果</span><span class="nb">clone</span><span class="err">下来只有</span><span class="n">master</span><span class="err">分支，那可以新建个</span><span class="n">source</span><span class="err">分支，</span>
</span><span class='line'><span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="n">source</span>
</span><span class='line'><span class="err">这个命令会新建</span><span class="n">source</span><span class="err">分支并切换到</span><span class="n">source</span><span class="err">分支。</span>
</span><span class='line'><span class="err">再执行</span><span class="n">git</span> <span class="n">pull</span> <span class="n">origin</span> <span class="n">source</span> <span class="err">把远程的</span><span class="n">github</span><span class="err">上</span><span class="n">source</span><span class="err">分支拉到本地</span><span class="n">source</span><span class="err">分支。</span>
</span><span class='line'>
</span><span class='line'><span class="n">cd</span> <span class="n">rtwf</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">bundler</span>
</span><span class='line'><span class="n">bundle</span> <span class="n">install</span>
</span><span class='line'><span class="n">rake</span> <span class="n">setup_github_pages</span> <span class="c1">#设置你的目录</span>
</span></code></pre></td></tr></table></div></figure>


<p>配置好之后，DOS cd 到rtwf目录下就可以写blog了。</p>

<p>在此之前请确保你在source 分支下，通过git branch 命令可以查看。你在哪个分支下。 git checkout source 可以切换到source分支</p>

<figure class='code'><figcaption><span>发布的步骤</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rake</span> <span class="n">new_post</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">]</span> <span class="c1">#创建个新的文章，在source/_post目录下，打开它，就可以编辑了。</span>
</span><span class='line'><span class="c1">#注意title这里命令生成的title只能是英文，你可以生成后的post中修改title</span>
</span><span class='line'>
</span><span class='line'><span class="err">编辑完保存之后。</span>
</span><span class='line'><span class="n">rake</span> <span class="n">generate</span> <span class="c1">#生成网页</span>
</span><span class='line'><span class="n">rake</span> <span class="n">preview</span> <span class="c1">#预览 打开127.0.0.1:4000 可以看到。</span>
</span><span class='line'><span class="n">rake</span> <span class="n">deploy</span> <span class="c1">#发布</span>
</span><span class='line'>
</span><span class='line'><span class="err">然后记得提交，须要权限，要</span><span class="n">ssh</span><span class="err">的</span><span class="kp">private</span> <span class="n">key</span><span class="err">。</span>
</span><span class='line'><span class="n">git</span> <span class="n">add</span> <span class="o">.</span>
</span><span class='line'><span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;your commit message&quot;</span>
</span><span class='line'><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">source</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果想弄清楚octopress各个目录的作用，以及如何发布的。可以看根目录下的Rakefile文件中的ruby代码 genenrate deploy的task。大概就可以清楚几个主要目录的作用了</p>

<p>git remote -v 命令可以查远程的地址。
<img src="../images/gitremote.png" alt="" />
有不懂的git命令都可以用git command &mdash;help 来查这个command。</p>

<p>为了确保安全不造成混乱，以后每次写blog之前，都要检查，你是否是在source分支下，是否跟服务器上是一致的。</p>

<figure class='code'><figcaption><span>发布的步骤</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="n">checkout</span> <span class="n">source</span> <span class="c1">#切换到source分支</span>
</span><span class='line'><span class="n">git</span> <span class="n">pull</span> <span class="n">origin</span> <span class="n">source</span> <span class="c1">#更新服务器上的内容到本地</span>
</span></code></pre></td></tr></table></div></figure>


<h2>注意事项</h2>

<ul>
<li>图片最好是上传到一些可以保存图片的网站上，然后用 octopress 的Image 标签来引用， 相关用法<a href="http://octopress.org/docs/plugins/image-tag/%E3%80%82">http://octopress.org/docs/plugins/image-tag/%E3%80%82</a>
用markdown语法也是可以的，不要写本地的相对路径（如上面的那张图片，会导致在Tag目录下看不到</li>
</ul>


<p>相关的文章
octopress+github 构建blog <a href="http://xuhehuan.com/783.html">在Github上搭建Octopress博客</a>
<a href="http://caiqinghua.com/blog/2013/08/26/deploy-octopress-to-github-pages/">在github Pages上部署octopress搭建个人博客系统</a></p>

<p><a href="http://octopress.org/">http://octopress.org/</a> 官方文档必看。这里有许多官方的plugin介绍。包括代码高亮，插入网络上图片等。</p>

<p>MarkDown的语法可以参考</p>

<p><a href="http://sweetdark.github.io/blog/2013/01/02/write-markdown/">用Markdown写Markdown语法说明</a></p>

<p><strong>markdown 中两个回车才是换行</strong></p>

<p>-git的学习</p>

<p>英文10本
<a href="http://sixrevisions.com/resources/git-tutorials-beginners/#comments">http://sixrevisions.com/resources/git-tutorials-beginners/#comments</a></p>

<p>中文</p>

<p><a href="http://gitbook.liuhui998.com/index.html">http://gitbook.liuhui998.com/index.html</a></p>

<p>详解系列</p>

<p><a href="http://blog.jobbole.com/24379/">http://blog.jobbole.com/24379/</a></p>

<p><a href="http://blog.jobbole.com/25808/">http://blog.jobbole.com/25808/</a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>最新发布</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/23/buildbot-build/">buildbot的搭建总结</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/17/vs-error-collection/">vs编译错误及解决办法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/09/eclipse-tools/">Eclipse 工具</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/09/local-reference-table-overflow/">Andriod ndk error local reference table overflow Max 512</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/03/how-to-install-octproess/">如何使用本博客</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><embed type='application/x-shockwave-flash' src='/javascripts/tagcloud.swf'width='100%' height='250' bgcolor='#f2f2f2' id='tagcloudflash' name='tagcloudflash' quality='high' allowscriptaccess='always'flashvars="tcolor=0x333333&amp;tcolor2=0x333333&amp;hicolor=0x000000&amp;tspeed=100&amp;distr=true&amp;mode=tags&amp;tagcloud=%3Ctags%3E%3Ca+href%3D%27http%3A%2F%2Frtwf.github.io%2Fblog%2Ftags%2Fbuild%27+style%3D%27font-size%3A+50.0%25%27%3Ebuild%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Frtwf.github.io%2Fblog%2Ftags%2Fcompile%27+style%3D%27font-size%3A+50.0%25%27%3ECompile%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Frtwf.github.io%2Fblog%2Ftags%2Fjni%27+style%3D%27font-size%3A+50.0%25%27%3EJNI%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Frtwf.github.io%2Fblog%2Ftags%2Foctopress%27+style%3D%27font-size%3A+50.0%25%27%3Eoctopress%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Frtwf.github.io%2Fblog%2Ftags%2Ftools%27+style%3D%27font-size%3A+50.0%25%27%3Etools%3C%2Fa%3E+%3C%2Ftags%3E"></span>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - 邱俊炜 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sweetdark';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
